# ----
# ì‘ì„±ëª©ì  : í†µí•© ì˜ìƒ ë¶„ì„ API ì„¤ì¹˜ ê°€ì´ë“œ ë¬¸ì„œ
# ì‘ì„±ì¼ : 2025-06-18

# ë³€ê²½ì‚¬í•­ ë‚´ì—­ (ë‚ ì§œ | ë³€ê²½ëª©ì  | ë³€ê²½ë‚´ìš© | ì‘ì„±ì ìˆœìœ¼ë¡œ ê¸°ì…)
# 2025-06-18 | ìµœì´ˆ êµ¬í˜„ | conda í™˜ê²½ ì„¤ì • ë° ì˜ì¡´ì„± ì„¤ì¹˜ ì™„ì „ ê°€ì´ë“œ | ì´ì¬ì¸
# ----

# ğŸš€ í†µí•© ì˜ìƒ ë¶„ì„ API ì„¤ì¹˜ ê°€ì´ë“œ

ì´ ë¬¸ì„œëŠ” **í†µí•© ì˜ìƒ ë¶„ì„ API** í”„ë¡œì íŠ¸ì˜ ì™„ì „í•œ ì„¤ì¹˜ ë° ì„¤ì • ê°€ì´ë“œì…ë‹ˆë‹¤.

## ğŸ“‹ ëª©ì°¨

1. [ì‚¬ì „ ìš”êµ¬ì‚¬í•­](#ì‚¬ì „-ìš”êµ¬ì‚¬í•­)
2. [Conda í™˜ê²½ ì„¤ì •](#conda-í™˜ê²½-ì„¤ì •)
3. [ì˜ì¡´ì„± ì„¤ì¹˜ ë°©ë²•](#ì˜ì¡´ì„±-ì„¤ì¹˜-ë°©ë²•)
4. [ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •](#ë°ì´í„°ë² ì´ìŠ¤-ì„¤ì •)
5. [í™˜ê²½ë³€ìˆ˜ ì„¤ì •](#í™˜ê²½ë³€ìˆ˜-ì„¤ì •)
6. [ì‹¤í–‰ ë° í…ŒìŠ¤íŠ¸](#ì‹¤í–‰-ë°-í…ŒìŠ¤íŠ¸)
7. [ë¬¸ì œ í•´ê²°](#ë¬¸ì œ-í•´ê²°)

---

## ğŸ”§ ì‚¬ì „ ìš”êµ¬ì‚¬í•­

### 1. ì‹œìŠ¤í…œ ì‚¬ì–‘
- **ìš´ì˜ì²´ì œ**: macOS 10.14+, Ubuntu 18.04+, Windows 10+
- **ë©”ëª¨ë¦¬**: ìµœì†Œ 8GB RAM (ê¶Œì¥ 16GB+)
- **ì €ì¥ê³µê°„**: ìµœì†Œ 5GB ì—¬ìœ  ê³µê°„
- **Python**: 3.9.x (condaë¡œ ìë™ ì„¤ì¹˜ë¨)

### 2. í•„ìˆ˜ ì‹œìŠ¤í…œ íŒ¨í‚¤ì§€

#### macOS (Homebrew ì‚¬ìš©)
```bash
# Homebrewê°€ ì—†ë‹¤ë©´ ë¨¼ì € ì„¤ì¹˜
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# í•„ìˆ˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜
brew install ffmpeg
brew install mongodb-community
brew install mariadb
```

#### Ubuntu/Debian
```bash
# ì‹œìŠ¤í…œ íŒ¨í‚¤ì§€ ì—…ë°ì´íŠ¸
sudo apt update && sudo apt upgrade -y

# í•„ìˆ˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜
sudo apt install -y ffmpeg
sudo apt install -y mongodb
sudo apt install -y mariadb-server
sudo apt install -y python3-dev
sudo apt install -y build-essential
```

#### Windows
```powershell
# Chocolatey ì‚¬ìš© (ê´€ë¦¬ì ê¶Œí•œ PowerShell)
choco install ffmpeg
choco install mongodb
choco install mariadb

# ë˜ëŠ” ì§ì ‘ ë‹¤ìš´ë¡œë“œ:
# - FFmpeg: https://ffmpeg.org/download.html
# - MongoDB: https://www.mongodb.com/try/download/community
# - MariaDB: https://mariadb.org/download/
```

### 3. Anaconda/Miniconda ì„¤ì¹˜

#### Miniconda ì„¤ì¹˜ (ê¶Œì¥)
```bash
# macOS/Linux
wget https://repo.anaconda.com/miniconda/Miniconda3-latest-MacOSX-x86_64.sh  # macOS
wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh   # Linux
bash Miniconda3-latest-*.sh

# WindowsëŠ” https://docs.conda.io/en/latest/miniconda.html ì—ì„œ ì„¤ì¹˜
```

---

## ğŸ Conda í™˜ê²½ ì„¤ì •

### ë°©ë²• 1: environment.yml ì‚¬ìš© (ê¶Œì¥)

```bash
# 1. í”„ë¡œì íŠ¸ í´ë¡ 
git clone <repository-url>
cd model_video

# 2. conda í™˜ê²½ ìë™ ìƒì„± ë° í™œì„±í™”
conda env create -f environment.yml
conda activate model_video

# 3. í™˜ê²½ í™•ì¸
conda list
python --version  # Python 3.9.23 í™•ì¸
```

### ë°©ë²• 2: ìˆ˜ë™ í™˜ê²½ ìƒì„±

```bash
# 1. conda í™˜ê²½ ìƒì„±
conda create -n model_video python=3.9.23 -y

# 2. í™˜ê²½ í™œì„±í™”
conda activate model_video

# 3. ê¸°ë³¸ íŒ¨í‚¤ì§€ ì„¤ì¹˜
conda install -c conda-forge numpy pandas opencv matplotlib -y
conda install -c pytorch pytorch torchvision cpuonly -y

# 4. pip íŒ¨í‚¤ì§€ ì„¤ì¹˜
pip install -r requirements.txt
```

---

## ğŸ“¦ ì˜ì¡´ì„± ì„¤ì¹˜ ë°©ë²•

### ğŸ¯ ë¹ ë¥¸ ì„¤ì¹˜ (ì¶”ì²œ)

```bash
# conda í™˜ê²½ í™œì„±í™” í™•ì¸
conda activate model_video

# ìë™ ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
chmod +x install_dependencies.sh
./install_dependencies.sh
```

### ğŸ”§ ìˆ˜ë™ ì„¤ì¹˜

```bash
# 1. conda íŒ¨í‚¤ì§€ ì„¤ì¹˜
conda install -c conda-forge numpy=1.24.4 pandas=2.0.3 -y
conda install -c pytorch pytorch=2.7.1 torchvision=0.22.1 cpuonly -y

# 2. pip íŒ¨í‚¤ì§€ ì„¤ì¹˜
pip install --no-cache-dir -r requirements.txt

# 3. ì„¤ì¹˜ í™•ì¸
python -c "import torch, cv2, fastapi; print('âœ… ì£¼ìš” íŒ¨í‚¤ì§€ ì„¤ì¹˜ ì„±ê³µ')"
```

### ğŸš€ GPU ì§€ì› ì„¤ì¹˜ (ì„ íƒì‚¬í•­)

NVIDIA GPUê°€ ìˆê³  CUDAë¥¼ ì‚¬ìš©í•˜ë ¤ë©´:

```bash
# CUDA 11.8 ê¸°ì¤€
conda install -c pytorch pytorch=2.7.1 torchvision=0.22.1 pytorch-cuda=11.8 -y

# CUDA ë²„ì „ í™•ì¸
python -c "import torch; print(f'CUDA ì‚¬ìš© ê°€ëŠ¥: {torch.cuda.is_available()}')"
```

---

## ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •

### MongoDB ì„¤ì •

#### macOS
```bash
# MongoDB ì„œë¹„ìŠ¤ ì‹œì‘
brew services start mongodb-community

# ì—°ê²° í…ŒìŠ¤íŠ¸
mongosh --eval "db.adminCommand('ismaster')"
```

#### Linux
```bash
# MongoDB ì„œë¹„ìŠ¤ ì‹œì‘ ë° í™œì„±í™”
sudo systemctl start mongodb
sudo systemctl enable mongodb

# ì—°ê²° í…ŒìŠ¤íŠ¸
mongosh --eval "db.adminCommand('ismaster')"
```

### MariaDB ì„¤ì •

#### ì´ˆê¸° ì„¤ì •
```bash
# macOS
brew services start mariadb

# Linux
sudo systemctl start mariadb
sudo systemctl enable mariadb

# ë³´ì•ˆ ì„¤ì • (ë¹„ë°€ë²ˆí˜¸ ì„¤ì •)
sudo mysql_secure_installation
```

#### ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±
```sql
# MariaDB ì ‘ì†
mysql -u root -p

# ë°ì´í„°ë² ì´ìŠ¤ ë° ì‚¬ìš©ì ìƒì„±
CREATE DATABASE interview_analysis;
CREATE USER 'api_user'@'localhost' IDENTIFIED BY 'your_secure_password';
GRANT ALL PRIVILEGES ON interview_analysis.* TO 'api_user'@'localhost';
FLUSH PRIVILEGES;
EXIT;
```

---

## âš™ï¸ í™˜ê²½ë³€ìˆ˜ ì„¤ì •

### 1. .env íŒŒì¼ ìƒì„±

```bash
# .env.exampleì„ .envë¡œ ë³µì‚¬
cp .env.example .env

# ì—ë””í„°ë¡œ .env íŒŒì¼ í¸ì§‘
nano .env  # ë˜ëŠ” vim, vscode ë“±
```

### 2. í•„ìˆ˜ í™˜ê²½ë³€ìˆ˜ ì„¤ì •

```env
# ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •
MONGODB_URL=mongodb://localhost:27017
MONGODB_DATABASE=interview_analysis

MARIADB_HOST=localhost
MARIADB_PORT=3306
MARIADB_USER=api_user
MARIADB_PASSWORD=your_secure_password
MARIADB_DATABASE=interview_analysis

# AWS S3 ì„¤ì • (ì‹¤ì œ ê°’ìœ¼ë¡œ êµì²´)
AWS_ACCESS_KEY_ID=your_aws_access_key_id
AWS_SECRET_ACCESS_KEY=your_aws_secret_access_key
AWS_DEFAULT_REGION=ap-northeast-2
S3_BUCKET_NAME=your-bucket-name

# OpenAI API ì„¤ì •
OPENAI_API_KEY=your_openai_api_key
OPENAI_MODEL=gpt-4
OPENAI_ENABLED=true

# ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì •
LOG_LEVEL=INFO
DEBUG_MODE=false
```

### 3. í™˜ê²½ë³€ìˆ˜ í™•ì¸

```bash
# .env íŒŒì¼ ë¡œë“œ í…ŒìŠ¤íŠ¸
python -c "
from dotenv import load_dotenv
import os
load_dotenv()
print('MongoDB URL:', os.getenv('MONGODB_URL'))
print('AWS Region:', os.getenv('AWS_DEFAULT_REGION'))
print('OpenAI Enabled:', os.getenv('OPENAI_ENABLED'))
"
```

---

## ğŸš€ ì‹¤í–‰ ë° í…ŒìŠ¤íŠ¸

### 1. ê¸°ë³¸ ì‹¤í–‰

```bash
# conda í™˜ê²½ í™œì„±í™”
conda activate model_video

# ì†ŒìŠ¤ ë””ë ‰í† ë¦¬ë¡œ ì´ë™
cd src

# ê°œë°œ ì„œë²„ ì‹¤í–‰
uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

### 2. ìë™ ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸

```bash
# ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬
chmod +x run_server.sh

# ì„œë²„ ì‹¤í–‰
./run_server.sh
```

### 3. ì„œë¹„ìŠ¤ í™•ì¸

ë¸Œë¼ìš°ì €ì—ì„œ ë‹¤ìŒ URL ì ‘ì†:

- **API ë¬¸ì„œ**: http://localhost:8000/docs
- **í—¬ìŠ¤ì²´í¬**: http://localhost:8000/health
- **ëŒ€ì•ˆ ë¬¸ì„œ**: http://localhost:8000/redoc

### 4. ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸

```bash
# API í—¬ìŠ¤ì²´í¬
curl http://localhost:8000/health

# S3 ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ
curl http://localhost:8000/s3/available-users-questions

# ìµœê·¼ ë¶„ì„ ê²°ê³¼ ì¡°íšŒ
curl http://localhost:8000/analysis/recent?limit=5
```

---

## ğŸš¨ ë¬¸ì œ í•´ê²°

### ì¼ë°˜ì ì¸ ë¬¸ì œë“¤

#### 1. conda í™˜ê²½ ìƒì„± ì‹¤íŒ¨
```bash
# conda ì—…ë°ì´íŠ¸
conda update -n base -c defaults conda

# ìºì‹œ ì •ë¦¬
conda clean --all

# ë‹¤ì‹œ ì‹œë„
conda env create -f environment.yml
```

#### 2. OpenCV ì„¤ì¹˜ ì˜¤ë¥˜
```bash
# ê¸°ì¡´ opencv ì œê±°
pip uninstall opencv-python opencv-contrib-python -y

# ì¬ì„¤ì¹˜
pip install opencv-python==4.8.1.78 --no-cache-dir
```

#### 3. PyTorch ì„¤ì¹˜ ë¬¸ì œ
```bash
# PyTorch ê³µì‹ ì‚¬ì´íŠ¸ì—ì„œ ëª…ë ¹ì–´ í™•ì¸: https://pytorch.org/get-started/locally/

# CPU ë²„ì „
conda install pytorch torchvision cpuonly -c pytorch

# GPU ë²„ì „ (CUDA 11.8)
conda install pytorch torchvision pytorch-cuda=11.8 -c pytorch -c nvidia
```

#### 4. ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì˜¤ë¥˜
```bash
# MongoDB ìƒíƒœ í™•ì¸
brew services list | grep mongodb  # macOS
sudo systemctl status mongodb      # Linux

# MariaDB ìƒíƒœ í™•ì¸
brew services list | grep mariadb  # macOS
sudo systemctl status mariadb      # Linux

# í¬íŠ¸ ì‚¬ìš© í™•ì¸
lsof -i :27017  # MongoDB
lsof -i :3306   # MariaDB
```

#### 5. ë©”ëª¨ë¦¬ ë¶€ì¡± ì˜¤ë¥˜
```bash
# ì‹œìŠ¤í…œ ë©”ëª¨ë¦¬ í™•ì¸
free -h  # Linux
vm_stat  # macOS

# í”„ë¡œì„¸ìŠ¤ë³„ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰
top -o %MEM  # ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ìˆœ ì •ë ¬
```

### ì„±ëŠ¥ ìµœì í™”

#### 1. ë©€í‹°í”„ë¡œì„¸ì‹± í™œìš©
```bash
# Worker ìˆ˜ ì¦ê°€ (CPU ì½”ì–´ ìˆ˜ì— ë§ê²Œ ì¡°ì •)
uvicorn main:app --workers 4 --host 0.0.0.0 --port 8000
```

#### 2. ë©”ëª¨ë¦¬ ìµœì í™”
```python
# src/config.pyì—ì„œ ì„¤ì • ì¡°ì •
MAX_VIDEO_SIZE_MB = 100  # ì˜ìƒ í¬ê¸° ì œí•œ
FRAME_SKIP_INTERVAL = 3  # í”„ë ˆì„ ìŠ¤í‚µìœ¼ë¡œ ì²˜ë¦¬ ì†ë„ í–¥ìƒ
```

#### 3. ë””ìŠ¤í¬ ê³µê°„ ê´€ë¦¬
```bash
# ì„ì‹œ íŒŒì¼ ì •ë¦¬
rm -rf src/temp_uploads/*

# ë¡œê·¸ íŒŒì¼ ê´€ë¦¬
find . -name "*.log" -mtime +7 -delete
```

### ê³ ê¸‰ ì„¤ì •

#### 1. ì‹œìŠ¤í…œ ì„œë¹„ìŠ¤ ë“±ë¡ (Linux)
```bash
# /etc/systemd/system/model-video-api.service ìƒì„±
sudo tee /etc/systemd/system/model-video-api.service > /dev/null <<EOF
[Unit]
Description=Model Video Analysis API
After=network.target

[Service]
Type=simple
User=your_username
WorkingDirectory=/path/to/model_video/src
Environment=PATH=/home/your_username/miniconda3/envs/model_video/bin
ExecStart=/home/your_username/miniconda3/envs/model_video/bin/uvicorn main:app --host 0.0.0.0 --port 8000
Restart=always

[Install]
WantedBy=multi-user.target
EOF

# ì„œë¹„ìŠ¤ í™œì„±í™”
sudo systemctl enable model-video-api
sudo systemctl start model-video-api
```

#### 2. Nginx ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ ì„¤ì •
```nginx
# /etc/nginx/sites-available/model-video-api
server {
    listen 80;
    server_name your_domain.com;

    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

---

## ğŸ“ ì§€ì› ë° ë¬¸ì˜

ë¬¸ì œê°€ ì§€ì†ë˜ë©´ ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:

1. **ë¡œê·¸ í™•ì¸**: `tail -f logs/application.log`
2. **ì˜ì¡´ì„± í™•ì¸**: `conda list` ë° `pip list`
3. **í™˜ê²½ë³€ìˆ˜ í™•ì¸**: `.env` íŒŒì¼ ë‚´ìš©
4. **ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤**: CPU, ë©”ëª¨ë¦¬, ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰

ì¶”ê°€ ë„ì›€ì´ í•„ìš”í•˜ì‹œë©´ í”„ë¡œì íŠ¸ ë¦¬í¬ì§€í† ë¦¬ì˜ Issues íƒ­ì„ ì´ìš©í•´ì£¼ì„¸ìš”.

---

## ğŸ“ ì°¸ê³  ìë£Œ

- [FastAPI ê³µì‹ ë¬¸ì„œ](https://fastapi.tiangolo.com/)
- [PyTorch ì„¤ì¹˜ ê°€ì´ë“œ](https://pytorch.org/get-started/locally/)
- [OpenCV Python íŠœí† ë¦¬ì–¼](https://docs.opencv.org/4.x/d6/d00/tutorial_py_root.html)
- [MongoDB ì„¤ì¹˜ ê°€ì´ë“œ](https://docs.mongodb.com/manual/installation/)
- [MariaDB ì„¤ì¹˜ ê°€ì´ë“œ](https://mariadb.com/kb/en/getting-installing-and-upgrading-mariadb/)

---

**ğŸ‰ ì„¤ì¹˜ ì™„ë£Œ! ì´ì œ í†µí•© ì˜ìƒ ë¶„ì„ APIë¥¼ ì‚¬ìš©í•  ì¤€ë¹„ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.** 